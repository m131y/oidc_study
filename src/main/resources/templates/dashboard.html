<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>OIDC ëŒ€ì‹œë³´ë“œ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .token-display {
            word-break: break-all;
            max-height: 200px;
            overflow-y: auto;
        }
        .claim-table th { width: 30%; }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
        <a class="navbar-brand" href="/">OIDC Demo</a>
        <div class="navbar-nav ms-auto">
            <a class="nav-link" href="/logout">ë¡œê·¸ì•„ì›ƒ</a>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <div class="row">
        <!-- ì‚¬ìš©ì ì •ë³´ -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5>ğŸ‘¤ OIDC ì‚¬ìš©ì ì •ë³´</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <img th:src="${picture}" class="img-fluid rounded-circle"
                                 alt="í”„ë¡œí•„ ì‚¬ì§„" style="max-width: 80px;">
                        </div>
                        <div class="col-md-9">
                            <h6 th:text="${name}">ì‚¬ìš©ì ì´ë¦„</h6>
                            <p class="text-muted mb-1" th:text="${email}">ì´ë©”ì¼</p>
                            <p class="mb-1">
                                <span class="badge bg-success" th:if="${emailVerified}">ì´ë©”ì¼ ì¸ì¦ë¨</span>
                                <span class="badge bg-warning" th:unless="${emailVerified}">ì´ë©”ì¼ ë¯¸ì¸ì¦</span>
                            </p>
                            <small class="text-muted">Subject: <span th:text="${subject}"></span></small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- OIDC í”Œë¡œìš° ì •ë³´ -->
            <div class="card mt-3">
                <div class="card-header">
                    <h6>ğŸ”„ OIDC í”Œë¡œìš° ì™„ë£Œ</h6>
                </div>
                <div class="card-body">
                    <ol class="mb-0">
                        <li class="text-success">âœ“ Authorization Code íšë“</li>
                        <li class="text-success">âœ“ Access Token + ID Token êµí™˜</li>
                        <li class="text-success">âœ“ ID Token ê²€ì¦ ì™„ë£Œ</li>
                        <li class="text-success">âœ“ ì‚¬ìš©ì ì‹ ì› í™•ì¸ ì™„ë£Œ</li>
                        <li class="text-success">âœ“ UserInfo ì—”ë“œí¬ì¸íŠ¸ í˜¸ì¶œ (ì„ íƒì )</li>
                    </ol>
                </div>
            </div>
        </div>

        <!-- ID Token ì •ë³´ -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h6>ğŸ« ID Token ì •ë³´</h6>
                </div>
                <div class="card-body">
                    <table class="table table-sm claim-table">
                        <tr>
                            <th>ë°œê¸‰ì (iss)</th>
                            <td th:text="${issuer}"></td>
                        </tr>
                        <tr>
                            <th>ëŒ€ìƒ (aud)</th>
                            <td class="small" th:text="${audience}"></td>
                        </tr>
                        <tr>
                            <th>ë°œê¸‰ì‹œê°„ (iat)</th>
                            <td th:text="${issuedAt}"></td>
                        </tr>
                        <tr>
                            <th>ë§Œë£Œì‹œê°„ (exp)</th>
                            <td th:text="${expiresAt}"></td>
                        </tr>
                    </table>
                </div>
            </div>

            <!-- API í…ŒìŠ¤íŠ¸ -->
            <div class="card mt-3">
                <div class="card-header">
                    <h6>ğŸ§ª API í…ŒìŠ¤íŠ¸</h6>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <button class="btn btn-primary btn-sm" onclick="fetchIdTokenClaims()">
                            ID Token í´ë ˆì„ ì¡°íšŒ
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="fetchIdTokenInfo()">
                            ID Token ìƒì„¸ ì •ë³´
                        </button>
                        <button class="btn btn-info btn-sm" onclick="fetchUserInfo()">
                            UserInfo ì—”ë“œí¬ì¸íŠ¸
                        </button>
                    </div>
                    <div id="apiResult" class="mt-3"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ID Token ì›ë³¸ -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h6>ğŸ” ID Token ì›ë³¸ (JWT)</h6>
                </div>
                <div class="card-body">
                    <div class="token-display">
                        <small class="font-monospace" th:text="${idTokenValue}"></small>
                    </div>
                    <div class="mt-2">
                        <small class="text-muted">
                            ìœ„ í† í°ì„ <a href="https://jwt.io" target="_blank">jwt.io</a>ì—ì„œ ë””ì½”ë”©í•´ë³´ì„¸ìš”!
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì „ì²´ í´ë ˆì„ -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h6>ğŸ“‹ ì „ì²´ í´ë ˆì„ ì •ë³´</h6>
                </div>
                <div class="card-body">
                    <pre class="bg-light p-3 small" th:text="${allClaims != null && !allClaims.isEmpty() ?
                        allClaims : 'í´ë ˆì„ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.'}"></pre>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    async function fetchIdTokenClaims() {
        try {
            const response = await fetch('/api/id-token/claims');
            const data = await response.json();
            displayResult('ID Token í´ë ˆì„', data);
        } catch (error) {
            displayResult('ì˜¤ë¥˜', {error: error.message});
        }
    }

    async function fetchIdTokenInfo() {
        try {
            const response = await fetch('/api/id-token/info');
            const data = await response.json();
            displayResult('ID Token ìƒì„¸ ì •ë³´', data);
        } catch (error) {
            displayResult('ì˜¤ë¥˜', {error: error.message});
        }
    }

    async function fetchUserInfo() {
        try {
            const response = await fetch('/api/userinfo');
            const data = await response.json();
            displayResult('UserInfo ì—”ë“œí¬ì¸íŠ¸', data);
        } catch (error) {
            displayResult('ì˜¤ë¥˜', {error: error.message});
        }
    }

    function displayResult(title, data) {
        document.getElementById('apiResult').innerHTML = `
            <h6 class="mt-3">${title}</h6>
            <pre class="bg-light p-2 small">${JSON.stringify(data, null, 2)}</pre>
        `;
    }
</script>
</body>
</html>